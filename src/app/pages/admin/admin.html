<div class="admin-page">
  <h1>Admin Panel</h1>
  <p class="admin-subtitle">Manage currencies</p>

  @if (error()) {
    <div class="alert-error" role="alert">{{ error() }}</div>
  }

  <div class="admin-layout">
    <!-- Form -->
    <div class="admin-form card">
      <h2>{{ editingId() ? 'Edit Coin' : 'Add New Coin' }}</h2>

      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label class="form-label" for="code">Code</label>
          <input
            id="code"
            class="form-input"
            type="text"
            formControlName="code"
            placeholder="e.g. ARS"
            maxlength="5"
            [attr.readonly]="editingId() ? '' : null"
          />
          @if (form.controls.code.touched && form.controls.code.hasError('required')) {
            <span class="form-error">Code is required</span>
          }
        </div>

        <div class="form-group">
          <label class="form-label" for="legend">Legend</label>
          <input
            id="legend"
            class="form-input"
            type="text"
            formControlName="legend"
            placeholder="e.g. Peso Argentino"
          />
          @if (form.controls.legend.touched && form.controls.legend.hasError('required')) {
            <span class="form-error">Legend is required</span>
          }
        </div>

        <div class="form-group">
          <label class="form-label" for="symbol">Symbol</label>
          <input
            id="symbol"
            class="form-input"
            type="text"
            formControlName="symbol"
            placeholder="e.g. $"
            maxlength="5"
          />
          @if (form.controls.symbol.touched && form.controls.symbol.hasError('required')) {
            <span class="form-error">Symbol is required</span>
          }
        </div>

        <div class="form-group">
          <label class="form-label" for="convertibilityIndex">Convertibility Index (vs USD)</label>
          <input
            id="convertibilityIndex"
            class="form-input"
            type="number"
            formControlName="convertibilityIndex"
            step="0.000001"
            min="0"
            placeholder="e.g. 0.0009"
          />
          @if (form.controls.convertibilityIndex.touched && form.controls.convertibilityIndex.hasError('required')) {
            <span class="form-error">Convertibility index is required</span>
          } @else if (form.controls.convertibilityIndex.touched && form.controls.convertibilityIndex.hasError('min')) {
            <span class="form-error">Must be a positive number</span>
          }
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary">
            {{ editingId() ? 'Update Coin' : 'Add Coin' }}
          </button>
          @if (editingId()) {
            <button type="button" class="btn btn-secondary" (click)="cancelEdit()">
              Cancel
            </button>
          }
        </div>
      </form>
    </div>

    <!-- Coin Table -->
    <div class="admin-table-wrapper card">
      <h2>Existing Coins</h2>

      <div class="table-container" role="region" aria-label="Coins list" tabindex="0">
        <table class="coins-table">
          <thead>
            <tr>
              <th scope="col">Code</th>
              <th scope="col">Legend</th>
              <th scope="col">Symbol</th>
              <th scope="col">Index (USD)</th>
              <th scope="col"><span class="visually-hidden">Actions</span></th>
            </tr>
          </thead>
          <tbody>
            @for (coin of coins(); track coin.id) {
              <tr [class.row-editing]="editingId() === coin.id">
                <td>
                  <span class="coin-code">{{ coin.code }}</span>
                </td>
                <td>{{ coin.legend }}</td>
                <td>{{ coin.symbol }}</td>
                <td>{{ coin.convertibilityIndex | number:'1.2-6' }}</td>
                <td class="actions-cell">
                  <button
                    class="btn-icon"
                    (click)="editCoin(coin)"
                    [attr.aria-label]="'Edit ' + coin.code"
                  >
                    ‚úèÔ∏è
                  </button>
                  <button
                    class="btn-icon btn-icon-danger"
                    (click)="deleteCoin(coin)"
                    [attr.aria-label]="'Delete ' + coin.code"
                  >
                    üóëÔ∏è
                  </button>
                </td>
              </tr>
            } @empty {
              <tr>
                <td colspan="5" class="empty-state">No coins added yet</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
